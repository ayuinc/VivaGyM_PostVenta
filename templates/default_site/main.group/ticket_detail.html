{embed="includes/header" }
<!-- <script type="text/javascript" src="{site_url}lib/vendor/bootstrapValidator.js"></script> -->
<script type="text/javascript" src="{site_url}lib/edit-caso-form.js"></script>
  
  {embed="includes/bredcrumb_admin" }

  <div class="row">

    <div class="col-md-9 col-sm-9">
      <div class="panel p-14">
        {exp:member:custom_profile_data} <!-- edicion o lectura de acuerdo a la sesion  -->
          {exp:switchee variable = "{member_group}" parse="inward"}
            {case value="admin_viva"}

              {exp:freeform:edit
                form_name="atencion_por_garantia"
                entry_id="{segment_3}"
                restrict_edit_to_author="no"
                return="main/ticket_detail/{segment_3}"
                allow_status_edit="yes" 
                form:id="edit-caso-form" }

                <div class="panel-heading bg-white p-0">
                  <div class="panel-title mb-14">
                    <div class="clearfix">
                      <div class="col-sm-6 pl-0 col-xs-6">
                        <h2 class="medium m-0">No. de caso: {segment_3}</h2>
                      </div>
                      <div class="col-sm-6 col-xs-6">                  
                          <a href="#" class="text-info block pt-14 edit-form-trigger lowercase not-underline icon-pencil text-right"></a>
                        <div class="mt-7 hidden submit-form text-right">
                          <a href="#" class="text-danger small edit-form-cancel hidden">Cancelar</a>
                          <input type="submit" class="btn btn-sm btn-default" value="Guardar">
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr class="m-0">
                </div>

                <div class="panel-body p-0">
                  <div class="row mt-14">

                    <div class="col-sm-4">
                      {embed="includes/ver_foto" caso="{segment_3}"}
                    </div>

                    <div class="col-sm-4">
                      <h5 class="light uppercase">Datos del propietario</h5>
                      <ul class="list-unstyled">
                        {embed="main/datos_user" user_id="{freeform:edit_data:id_cliente}" }

                        <li class="mb-7"><strong>Tipo de problema</strong><br><?php $var="{freeform:edit_data:tipo_de_problema}"; ?>
                          
                          <div class="form-group" id="tipo_problema_select" style="display:none;">
                            <select name="tipo_de_problema" id="mySelect" class="select-override form-control input-sm">
                              <option value="Pisos" <?php if($var=="Pisos"){echo "selected";}?> >Pisos</option>
                              <option value="Paredes" <?php if($var=="Paredes"){echo "selected";}?>>Paredes</option>
                              <option value="Instalaciones eléctricas" <?php if($var=="Instalaciones eléctricas"){echo "selected";}?>>Instalaciones eléctricas</option>
                              <option value="Instalaciones sanitarias" <?php if($var=="Instalaciones sanitarias"){echo "selected";}?>>Instalaciones sanitarias</option>
                              <option value="Carpintería metálica" <?php if($var=="Carpintería metálica"){echo "selected";}?>>Carpintería metálica</option>
                              <option value="Carpintería de madera" <?php if($var=="Carpintería de madera"){echo "selected";}?>>Carpintería de madera</option>
                            </select>
                          </div>

                          <div class="form-group" id="tipo_problema_txt" style="display:block;">
                            {freeform:edit_data:tipo_de_problema}
                          </div>
                        </li>
                        <li class="mb-7"><strong>Otro dep. afectado</strong><br>
                          <input type="text" class="form-control input-blank input-sm" name="nro_otro_departamento_afectado" value="{freeform:edit_data:nro_otro_departamento_afectado}"></li>
                        </ul>
                    </div>
                    <div class="col-sm-4">
                      <h5 class="light uppercase">Datos del responsable</h5>
                      <ul class="list-unstyled">
                        <li class="mb-7"><strong>Fecha de solicitud</strong><br>{freeform:edit_data:entry_date format="%j %F %Y"}</li>

                        <li class="mb-7"><strong>Responsable Viva</strong>
                          {if freeform:edit_data:persona_asignada_viva =="" }<br>Por asignar{if:else}
                          <div id="persona_asignada_viva_txt" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:edit_data:persona_asignada_viva}"}</div>

                          <div class="form-group" id="persona_asignada_viva" style="display:none; margin-top:-20px ;">
                            {embed="includes/select_per" p_find="{freeform:edit_data:persona_asignada_viva}" grupo="7" var_name="persona_asignada_viva" rol=""}
                          </div>
                          {/if}
                        </li> 

                        <li class="mb-7"><strong>Responsable GyM</strong>
                          {if freeform:edit_data:persona_asignada_gym =="" }<br>Por asignar{if:else}
                          <div id="persona_asignada_gym_txt" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:edit_data:persona_asignada_gym}"}</div>

                          <div class="form-group" id="persona_asignada_gym" style="display:none; margin-top:-20px ;">
                            {embed="includes/select_per" p_find="{freeform:edit_data:persona_asignada_gym}" grupo="8" var_name="persona_asignada_gym" rol}
                          </div>
                          {/if}
                        </li>

                        <li class="mb-7"><strong>Agente inspección</strong>
                          {if freeform:edit_data:inspector_asignado =="" }<br>Por asignar{if:else}
                          <div id="inspector_asignado_txt" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:edit_data:inspector_asignado}"}</div>

                          <div class="form-group" id="inspector_asignado" style="display:none; margin-top:-20px ;">
                            {embed="includes/select_per" p_find="{freeform:edit_data:inspector_asignado}" grupo="9" var_name="inspector_asignado" rol="inspector"}
                          </div>
                          {/if}
                        </li>
                        
                        <li class="mb-7"><strong>Agente construcción</strong>
                          {if freeform:edit_data:constructor_asignado =="" }<br>Por asignar{if:else}
                          <div id="constructor_asignado_txt" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:edit_data:constructor_asignado}"}</div>

                          <div class="form-group" id="constructor_asignado" style="display:none; margin-top:-20px ;">
                            {embed="includes/select_per" p_find="{freeform:edit_data:constructor_asignado}" grupo="9" var_name="constructor_asignado" rol="ejecutor"}
                          </div>
                          {/if}
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="row mt-21">
                  <div class="col-sm-12">
                    <div class="descripcion p-14 box-shadow">
                      <h5 class="light uppercase">Descripción</h5>
                      <hr class="double">
                      <p>{freeform:edit_data:descripcion_problema}</p>
                    </div>
                  </div>
                </div>
              {/exp:freeform:edit}
              <!--</form>-->
            {/case}
            {case default="Yes"}
              {exp:freeform:entries form_id="2" entry_id="{segment_3}" limit="1" status="open|closed" } 
                <div class="panel-heading bg-white p-0">
                  <div class="panel-title mb-14">
                    <div class="clearfix">
                      <div class="col-sm-6 pl-0 col-xs-6">
                        <h2 class="medium m-0">No. de caso: {segment_3}</h2>
                      </div>
                    </div>
                  </div>
                  <hr class="m-0">
                </div>

                <div class="panel-body p-0">
                  <div class="row mt-14">

                    <div class="col-sm-4">
                      {embed="includes/ver_foto" caso="{segment_3}"}
                    </div>

                    <div class="col-sm-4">
                      <h5 class="light uppercase">Datos del propietario</h5>
                      <ul class="list-unstyled">
                        {embed="main/datos_user" user_id="{freeform:field:id_cliente}" }
                        <li class="mb-7"><strong>Tipo de problema</strong><br>{freeform:field:tipo_de_problema}</li>
                        <li class="mb-7"><strong>Otro dep. afectado</strong><br>{freeform:field:nro_otro_departamento_afectado}</li>
                      </ul>
                    </div>
                    <div class="col-sm-4">
                      <h5 class="light uppercase">Datos del responsable</h5>
                      <ul class="list-unstyled">
                        <li class="mb-7"><strong>Fecha de solicitud</strong><br>{freeform:entry_date format="%j %F %Y"}</li>

                        <li class="mb-7"><strong>Responsable Viva</strong><br>
                          {if freeform:field:persona_asignada_viva =="" }Por asignar{if:else}
                            <div class="" id="persona_asignada_viva" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:field:persona_asignada_viva}"}</div>
                          {/if}
                        </li>

                        <li class="mb-7"><strong>Responsable GyM</strong><br>
                          {if freeform:field:persona_asignada_gym =="" }Por asignar{if:else}
                            <div class="" id="persona_asignada_gym" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:field:persona_asignada_gym}"}</div>
                          {/if}
                        </li>

                        <li class="mb-7"><strong>Agente inspección</strong><br>
                          {if freeform:field:inspector_asignado =="" }Por asignar{if:else}
                            <div class="" id="inspector_asignado" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:field:inspector_asignado}"}</div>
                          {/if}
                        </li>
                        
                        <li class="mb-7"><strong>Agente construcción</strong><br>
                          {if freeform:field:constructor_asignado =="" }Por asignar{if:else}
                            <div class="" id="constructor_asignado" style="display:block;">{embed="includes/nombre_per" p_find="{freeform:field:constructor_asignado}"}</div>
                          {/if}
                        </li>

                      </ul>
                    </div>
                  </div>
                </div>
                <div class="row mt-21">
                  <div class="col-sm-12">
                    <div class="descripcion p-14 box-shadow">
                      <h5 class="light uppercase">Descripción</h5>
                      <hr class="double">
                      <p>{freeform:field:descripcion_problema}</p>
                    </div>
                  </div>
                </div>
              {/exp:freeform:entries}
            {/case}
          {/exp:switchee}
        {/exp:member:custom_profile_data}  <!-- fin edicion o lectura de acuerdo a la sesion  -->

        <div class="row"> <!-- mostrar los pasos del ticket de acuerdo a la sesion  -->
          <div class="col-sm-12">
            <br>
            <div class="table-responsive">

              {exp:member:custom_profile_data}
                {exp:switchee variable = "{member_group}" parse="inward"}
                  
                  {case value="admin_viva"}<!-- admin viva 7 -->
                    {embed="includes/pasos_viva" entrada="{segment_3}"}
                  {/case}

                  {case value="admin_gym"}<!-- admin GyM 8 -->
                    {embed="includes/pasos_gym" entrada="{segment_3}"}
                  {/case}

                  {case value="insp_viva"}<!-- inspector viva 9 -->
                  {/case}

                  {case value="user_gym"}<!-- personal GyM que ejecuta el arreglo  10 -->
                  {/case}
                  
                {/exp:switchee}
              {/exp:member:custom_profile_data}

            </div>
          </div>
        </div><!-- fin mostrar los pasos del ticket de acuerdo a la sesion  -->

        <!-- <div class="row mt-21">
          <div class="col-sm-12">
            <div class="descripcion p-14 box-shadow">
              <h5 class="light uppercase">Archivos</h5>
              <hr class="double">
              {embed="includes/archivos_ticket" entrada="{segment_3}"}
            </div>
          </div>
        </div> -->

        <div class="row mt-21"> <!-- barra de comentarios -->
          <div class="col-sm-12">
            <div class="descripcion p-14 box-shadow">
              <h5 class="light uppercase">Notas</h5>
              <hr class="double">
              <!-- <p>{freeform:field:comentarios_garantia}</p> -->
              {embed="includes/nuevo_comentario" entrada="{segment_3}"}
            </div>
          </div>
        </div><!-- fin barra de comentarios -->

      </div>
    </div>

  {exp:member:custom_profile_data} <!-- sidebar de acuerdo a sesion -->
    {exp:switchee variable = "{member_group}" parse="inward"}
      
      {case value="admin_viva"}<!-- admin viva 7 -->
        {embed="includes/sidebar_viva" entrada="{segment_3}"}
      {/case}

      {case value="admin_gym"}<!-- admin GyM 8 -->
        {embed="includes/sidebar_gym" entrada="{segment_3}"}
      {/case}

      {case value="insp_viva"}<!-- inspector viva 9 -->
        {embed="includes/sidebar_insp" entrada="{segment_3}"}
      {/case}

      {case value="user_gym"}<!-- personal GyM que ejecuta el arreglo  10 -->
        {embed="includes/sidebar_cons" entrada="{segment_3}"}
      {/case}
      
    {/exp:switchee}
  {/exp:member:custom_profile_data} <!-- fin sidebar de acuerdo a sesion -->

</div>